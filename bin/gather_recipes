#!/usr/bin/env python3

import os
import shutil
import yaml

source_dir = f"{os.environ['HOME']}/Documents/Nick/03 Resources/011 Cooking/Recipes/"
target_dir = 'recipes/'

os.makedirs(target_dir, exist_ok=True)

for filename in os.listdir(source_dir):
    if not filename.lower().endswith('.md'):
        continue
    filepath = os.path.join(source_dir, filename)
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    if not content.startswith('---\n'):
        continue
    end_index = content.find('\n---\n', 4)
    if end_index == -1:
        continue
    frontmatter_str = content[4:end_index]
    try:
        frontmatter = yaml.safe_load(frontmatter_str)
        if frontmatter.get('public') == True:
            new_filename = filename.lower().replace(' ', '-')
            target_filepath = os.path.join(target_dir, new_filename)
            markdown_content = content[end_index + 5:]  # Skip past "\n---\n"
            with open(target_filepath, 'w', encoding='utf-8') as f:
                f.write(markdown_content)
    except yaml.YAMLError:
        continue
